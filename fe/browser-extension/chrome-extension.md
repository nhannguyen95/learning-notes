---
mindmap-plugin: basic
tags:
  - chrome-extension
---

# chrome-extension

## Architecture
- `manifest.json`
	- JSON configuration file located at root of project.
	- Contains extension info
		- Metadata (name, description, version number, icon, etc.)
		- Chrome API keys
		- Permissions needed
		- Service worker file, popup HTML file, content scripts, etc.
- Extension service worker
	- Event-based script browser runs in background (also known as "background scripts").
	- Can listen to extension events
		- [Standard service worker events](https://developer.mozilla.org/docs/Web/API/ServiceWorkerGlobalScope#events)
			- `ServiceWorkerGlobal.fetch`
			- `ServiceWorkerGlobal.message`
		- Events in [extension APIs](https://developer.chrome.com/docs/extensions/reference/)
			- `chrome.action`
				- User interaction with toolbar icon, etc.
			- `chrome.management`
				- Installation, uninstallation, enabling, disabling extension events.
			- `chrome.notifications`
				- User interaction with system notifications generated by the extension.
			- `chrome.permissions`
				- When extension permissions are granted or revoked by the user.
			- `chrome.runtime`
				- Extension lifecycle, messages events, etc.
			- `chrome.storage.onChanged`
			- `chrome.webNavigation`
				- Status of in-flight navigation requests.
	- Can access all Extension APIs.
	- Can't use DOM APIs provided by document's global Window object.
	- Run in its own environment, thus can't directly modify web page's content.
	- Event handlers
		- Need to be declared in the global scope (top level of the script).
		- This ensures they are registered synchronously on initial script execution.
		- Enabling Chrome to dispatch events to the service worker as soon as it starts.
	- Lifecycle
		- Installation
			- When?
				- User install or update a service worker from Chrome Web Store.
				- User load or update an unpacked extension using `chrome://extensions` page.
			- What events (in order)?
				- `ServiceWorkerRegistration.install`
					- Web service worker's install event.
				- `chrome.runtime.onInstalled`
					- Extension's install event.
					- Extension updated to a new version.
					- Chrome updated to a new version.
				- `ServiceWorkerRegistration.active`
					- Web service worker's active event.
					- Fired immediately after extension installation.
		- Startup
			- When?
				- A user profile starts.
			- What events?
				- `chrome.runtime.onStartup`
				- No service worker events are invoked.
		- Idle and shutdown
			- Chrome terminates a service worker when
				- After 30 secs of inactivity.
				- A single request (event or API call) takes longer than 5 min to proceed.
				- A `fetch()` response takes more than 30 secs to arrive.
			- Events and calls to extension APIs reset these timers.
			- Extensions should be designed to be resilient against unexpected termination.
			- To avoid resource consumption, avoid keeping your service worker alive indefinitely if possible.
			- Data persistence
				- Global variables you set will be lost if service worker shuts down.
				- Save values to storage instead.
					- `chrome.storage`
						- An extension API that offers multiple types of storage (local, session, managed, sync)
						- Stores JSON objects with developer-defined keys.
						- Won't be removed when user clears the web cache.
					- `IndexedDB`
						- Low-level API for client-side storage of structure data (files, blobs).
						- Provides primitives for creating transactional data storage and retrieval.
					- `CacheStorage`
						- Persistent storage mechanism for Request and Response object pairs.
						- Used to retrieve data from an endpoint.
						- Unless you're specifically proxying network requests via the fetch handler, you should use `chrome.storage`.
- Content scripts
	- Allows the extension to interact with and modify host pages by injecting code into them.
		- Inserting new element.
		- Changing website style.
		- Modifying DOM elements.
		- Etc.
	- Have limited access to Chrome APIs.
- HTML pages
	- An extension can have different HTML pages (depending on design).
	- HTML pages can use Chrome APIs.
	- Can't include inline JavaScript (they must point to a JavaScript file).
	- Common HTML pages
		- Popup page
			- Shown when clicking on extension toolbar icon.
		- Options page
			- Shown when right clicking on extension toolbar and choosing "Options".
			- Allow users to customize an extension.
- Other assets
	- Extension icons (required for being hosted in Chrome Web Store).
	- Images, fonts, etc.